# 出題文バリデーション - 要求定義

## 概要

出題文（`RawSentence`）がゲームで利用可能かを判定するバリデーションロジックを追加する。
ローカル JSON・ChatGPT API いずれのソースから取得した出題文にも適用し、不正なデータを除外する。

## 背景・目的

- ChatGPT API が生成する出題文には、ゲームで処理できない文字や不正なデータが混入する可能性がある
- ローカル JSON も手動編集ミスにより不正データが混入する可能性がある
- 不正データがゲームに渡るとサイレントに文字がスキップされ、表示と入力が一致しない不具合が発生する
- バリデーションにより不正データを事前に除外し、ゲーム体験の品質を保証する

## バリデーション要件

### SV-001: japanese フィールドの記号チェック

英字（a-z）のみで入力できない記号を含む出題文を除外する。

**除外対象:**

- 句読点: 、。
- 括弧: 「」『』（）
- 感嘆符・疑問符: ！？!?
- 数字（0-9、０-９）
- その他記号: ・…―～〜など

**許容:**

- 漢字、ひらがな、カタカナのみで構成された japanese は有効

### SV-002: reading フィールドの変換可能性チェック

`RomajiConverter` の `ROMAJI_MAP` で変換できない文字を含む reading を除外する。

**除外対象:**

- ROMAJI_MAP に登録されていないひらがな（単独の小書き文字 ぁぃぅぇぉ、ゃゅょ、ゐ、ゑ、ゔ など）
- 漢字、数字、記号、ラテン文字

### SV-003: reading フィールドの長音符チェック

長音符「ー」を含む reading を除外する。

**理由:**

- `RomajiConverter` は「ー」を ROMAJI_MAP に持たず、黙ってスキップする
- 結果としてローマ字と入力が一致しなくなる

### SV-004: reading フィールドの空白チェック

半角スペース・全角スペースを含む reading を除外する。

**理由:**

- ゲームの入力は英字のみ（a-z）であり、スペースキーは受け付けない
- ChatGPT が reading に空白を挟む場合がある

### SV-005: reading フィールドのカタカナ混入チェック

カタカナを含む reading を除外する。

**理由:**

- reading はひらがなのみであるべきだが、ChatGPT がカタカナ混じりの reading を返すことがある
- `RomajiConverter` はカタカナを ROMAJI_MAP に持たず、黙ってスキップする

### SV-006: 空文字チェック

`japanese` または `reading` が空文字・未定義の出題文を除外する。

## 機能要件

### FR-201: バリデーション関数

- `SentenceValidator` ドメインサービスとして実装する
- 1文ごとに有効/無効を判定する関数を提供する
- 無効な文を除外し、有効な文のみを返すフィルタ関数を提供する

### FR-202: バリデーション適用タイミング

- `useGame.ts` でリポジトリから取得した `RawSentence[]` に対して、ローマ字変換前にバリデーションを適用する
- ローカル・API いずれのソースでも同一のバリデーションを適用する

## 制約事項

- Domain 層（`src/domain/services/`）に配置する
- 既存の `RomajiConverter` や `InputValidator` には変更を加えない
- バリデーションで全文が除外された場合のエラーハンドリングは呼び出し側で行う
